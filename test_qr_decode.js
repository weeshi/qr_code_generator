const jsQR = require('jsqr');
const fs = require('fs');
const path = require('path');

// Test with a simple QR code data
// We'll create a minimal QR code pattern for testing
const testData = [
  // This is a very simple 21x21 QR code pattern (version 1)
  // Black = 255, White = 0
  [255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,0,255,0,255,0,255,255,255,255,255,255,255],
  [0,0,0,0,0,0,0,0,255,255,255,255,255,0,255,0,0,0,0,0,0],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,0,255,0,255,0,255,255,255,255,255,255,255],
  [0,0,0,0,0,0,0,0,255,255,255,255,255,0,255,0,0,0,0,0,0],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255],
  [255,255,255,255,255,255,255,0,255,0,255,0,255,0,255,255,255,255,255,255,255],
  [0,0,0,0,0,0,0,0,255,255,255,255,255,0,255,0,0,0,0,0,0],
  [255,255,255,255,255,255,255,0,255,255,255,255,255,0,255,255,255,255,255,255,255]
];

// Flatten the array
const imageData = new Uint8ClampedArray(testData.flat().flatMap(v => [v, v, v, 255]));

console.log('Testing jsQR library...');
console.log('Image data size:', imageData.length);

try {
  const result = jsQR(imageData, 21, 21);
  if (result) {
    console.log('✓ jsQR is working!');
    console.log('Decoded data:', result.data);
  } else {
    console.log('✓ jsQR library loaded successfully (no QR code in test pattern)');
  }
} catch (error) {
  console.error('✗ Error:', error.message);
}
